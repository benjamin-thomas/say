#!/usr/bin/env ruby

require_relative '../lib/say.rb'

require 'optparse'

options = {
  lang: 'en',
  sleep: nil,
  repeat: "5m",
}

OptionParser.new do |opts|
  opts.banner = "Usage: #{__FILE__} [options] MESSAGE"

  opts.on("-l", "--lang LANG", "specify language (default: en)") do |lang|
    options[:lang] = lang
  end

  opts.on("-s", "--sleep SLEEP_VALUE", "Don't play straight away but schedule to play by SLEEP_VALUE") do |sleep|
    options[:sleep] = sleep
  end

  opts.on("-r", "--repeat REPEAT_VALUE", "Loop every REPEAT_VALUE (default 5m)") do |repeat|
    options[:repeat] = repeat
  end
end.parse!

lang = options.fetch(:lang)
sleep = options.fetch(:sleep)
repeat = options.fetch(:repeat)
as = AudioSample.new(message: ARGV.join(" "), lang: lang, sleep: sleep, repeat: repeat)

begin
  as.play
rescue Interrupt
  puts "\nexiting..."
end
